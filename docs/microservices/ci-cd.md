---
title: CD/CI für Microservices
description: Continuous Integration und Continuous Delivery für Microservices
author: MikeWasson
ms.date: 12/08/2017
ms.openlocfilehash: 7d8a81b7bc236e50d722a68a0115b9220d4e094f
ms.sourcegitcommit: 786bafefc731245414c3c1510fc21027afe303dc
ms.translationtype: HT
ms.contentlocale: de-DE
ms.lasthandoff: 12/12/2017
---
# <a name="designing-microservices-continuous-integration"></a><span data-ttu-id="769a5-103">Entwerfen von Microservices: Continuous Integration</span><span class="sxs-lookup"><span data-stu-id="769a5-103">Designing microservices: Continuous integration</span></span>

<span data-ttu-id="769a5-104">Continuous Integration und Continuous Delivery (CI/CD) sind eine wichtige Voraussetzung für die erfolgreiche Verwendung von Microservices.</span><span class="sxs-lookup"><span data-stu-id="769a5-104">Continuous integration and continuous delivery (CI/CD) are a key requirement for achieving success with microservices.</span></span> <span data-ttu-id="769a5-105">Die Agilität, die von Microservices erwartet wird, lässt sich nur mit einem zuverlässigen CI/CD-Prozess erreichen.</span><span class="sxs-lookup"><span data-stu-id="769a5-105">Without a good CI/CD process, you will not achieve the agility that microservices promise.</span></span> <span data-ttu-id="769a5-106">Einige der CI/CD-bedingten Herausforderungen für Microservices sind auf die Verwendung mehrerer Codebasen und heterogener Buildumgebungen für die verschiedenen Dienste zurückzuführen.</span><span class="sxs-lookup"><span data-stu-id="769a5-106">Some of the CI/CD challenges for microservices arise from having multiple code bases and heterogenous build environments for the various services.</span></span> <span data-ttu-id="769a5-107">In diesem Kapitel werden die Herausforderungen und einige Lösungsansätze für das Problem beschrieben.</span><span class="sxs-lookup"><span data-stu-id="769a5-107">This chapter describes the challenges and recommends some approaches to the problem.</span></span>

![](./images/ci-cd.png)

<span data-ttu-id="769a5-108">Einer der Hauptgründe für die Implementierung einer Microservices-Architektur sind kürzere Versionszyklen.</span><span class="sxs-lookup"><span data-stu-id="769a5-108">Faster release cycles are one of the biggest reasons to adopt a microservices architecture.</span></span> 

<span data-ttu-id="769a5-109">In einer rein monolithischen Anwendung gibt es eine einzelne Buildpipeline, die die ausführbare Datei der Anwendung ausgibt.</span><span class="sxs-lookup"><span data-stu-id="769a5-109">In a purely monolithic application, there is a single build pipeline whose output is the application executable.</span></span> <span data-ttu-id="769a5-110">Sämtliche Entwicklungsarbeiten werden dieser Pipeline zugeführt.</span><span class="sxs-lookup"><span data-stu-id="769a5-110">All development work feeds into this pipeline.</span></span> <span data-ttu-id="769a5-111">Bei einem Fehler mit hoher Priorität muss eine Korrektur integriert, getestet und veröffentlicht werden, was die Veröffentlichung neuer Features verzögern kann.</span><span class="sxs-lookup"><span data-stu-id="769a5-111">If a high-priority bug is found, a fix must be integrated, tested, and published, which can delay the release of new features.</span></span> <span data-ttu-id="769a5-112">Diese Probleme lassen sich durch eine sorgfältige Modulgestaltung sowie durch die Verwendung von Featurebranches behandeln, die die Auswirkungen von Codeänderungen minimieren.</span><span class="sxs-lookup"><span data-stu-id="769a5-112">It's true that you can mitigate these problems by having well-factored modules and using feature branches to minimize the impact of code changes.</span></span> <span data-ttu-id="769a5-113">Mit zunehmender Komplexität und wachsendem Funktionsumfang einer monolithischen Anwendung nimmt jedoch häufig auch die Fehleranfälligkeit des Releaseprozesses zu.</span><span class="sxs-lookup"><span data-stu-id="769a5-113">But as the application grows more complex, and more features are added, the release process for a monolith tends to become more brittle and likely to break.</span></span> 

<span data-ttu-id="769a5-114">Die Microservices-Philosophie sieht kein langwieriges Releaseverfahren vor, in das sich die einzelnen Teams einreihen müssen.</span><span class="sxs-lookup"><span data-stu-id="769a5-114">Following the microservices philosophy, there should never be a long release train where every team has to get in line.</span></span> <span data-ttu-id="769a5-115">Das Team, das den Dienst „A“ erstellt, kann jederzeit ein Update veröffentlichen und muss nicht warten, bis Änderungen für den Dienst „B“ zusammengeführt, getestet und bereitgestellt wurden.</span><span class="sxs-lookup"><span data-stu-id="769a5-115">The team that builds service "A" can release an update at any time, without waiting for changes in service "B" to be merged, tested, and deployed.</span></span> <span data-ttu-id="769a5-116">Hierfür ist der CI/CD-Prozess unerlässlich.</span><span class="sxs-lookup"><span data-stu-id="769a5-116">The CI/CD process is critical to making this possible.</span></span> <span data-ttu-id="769a5-117">Ihre Releasepipeline muss automatisiert und äußerst zuverlässig sein, um die Risiken von Updatebereitstellungen zu minimieren.</span><span class="sxs-lookup"><span data-stu-id="769a5-117">Your release pipeline must be automated and highly reliable, so that the risks of deploying updates are minimized.</span></span> <span data-ttu-id="769a5-118">Bei täglich oder mehrmals täglich durchgeführten Veröffentlichungen in der Produktionsumgebung darf es nur ganz selten zu Regressionen oder Dienstausfällen kommen.</span><span class="sxs-lookup"><span data-stu-id="769a5-118">If you are releasing to production daily or multiple times a day, regressions or service disruptions must be very rare.</span></span> <span data-ttu-id="769a5-119">Sollte doch einmal ein fehlerhaftes Update bereitgestellt werden, müssen Sie schnell und zuverlässig einen Rollback oder Rollforward auf eine frühere Dienstversion ausführen können.</span><span class="sxs-lookup"><span data-stu-id="769a5-119">At the same time, if a bad update does get deployed, you must have a reliable way to quickly roll back or roll forward to a previous version of a service.</span></span>

![](./images/cicd-monolith.png)

<span data-ttu-id="769a5-120">CI/CD umfasst eigentlich mehrere verwandte Prozesse: Continuous Integration, Continuous Delivery und Continuous Deployment.</span><span class="sxs-lookup"><span data-stu-id="769a5-120">When we talk about CI/CD, we are really talking about several related processes: Continuous integration, continuous delivery, and continuous deployment.</span></span>

- <span data-ttu-id="769a5-121">Continuous Integration bedeutet, dass Änderungen am Code häufig in der Hauptverzweigung zusammengeführt werden. Durch automatisierte Build- und Testprozesse wird sichergestellt, dass der Code in der Hauptverzweigung immer die nötige Qualität für die Produktionsumgebung hat.</span><span class="sxs-lookup"><span data-stu-id="769a5-121">Continuous integration means that code changes are frequently merged into the main branch, using automated build and test processes to ensure that  code in the main branch is always production-quality.</span></span>

- <span data-ttu-id="769a5-122">Continuous Delivery bedeutet, dass Codeänderungen, die den CI-Prozess durchlaufen haben, automatisch in einer produktionsähnlichen Umgebung veröffentlicht werden.</span><span class="sxs-lookup"><span data-stu-id="769a5-122">Continuous delivery means that code changes that pass the CI process are automatically published to a production-like environment.</span></span> <span data-ttu-id="769a5-123">Für die Bereitstellung in der aktiven Produktionsumgebung ist unter Umständen eine manuelle Freigabe erforderlich, ansonsten ist der Prozess jedoch automatisiert.</span><span class="sxs-lookup"><span data-stu-id="769a5-123">Deployment into the live production environment may require manual approval, but is otherwise automated.</span></span> <span data-ttu-id="769a5-124">Dadurch soll erreicht werden, dass Ihr Code stets für die Bereitstellung in der Produktionsumgebung *bereit* ist.</span><span class="sxs-lookup"><span data-stu-id="769a5-124">The goal is that your code should always be *ready* to deploy into production.</span></span>

- <span data-ttu-id="769a5-125">Continuous Deployment bedeutet, dass Codeänderungen, die den CI/CD-Prozess durchlaufen haben, automatisch in der Produktionsumgebung bereitgestellt werden.</span><span class="sxs-lookup"><span data-stu-id="769a5-125">Continuous deployment means that code changes that pass the CI/CD process are automatically deployed into production.</span></span>

<span data-ttu-id="769a5-126">Im Kontext von Kubernetes und Microservices werden in der CI-Phase Containerimages erstellt, getestet und mithilfe von Push in eine Containerregistrierung übertragen.</span><span class="sxs-lookup"><span data-stu-id="769a5-126">In the context of Kubernetes and microservices, the CI stage is concerned with building and testing container images, and pushing those images to a container registry.</span></span> <span data-ttu-id="769a5-127">In der Bereitstellungsphase werden Pod-Spezifikationen aktualisiert, um das neueste Produktionsimage zu übernehmen.</span><span class="sxs-lookup"><span data-stu-id="769a5-127">In the deployment stage, pod specs are updated to pick up the latest production image.</span></span>

## <a name="challenges"></a><span data-ttu-id="769a5-128">Herausforderungen</span><span class="sxs-lookup"><span data-stu-id="769a5-128">Challenges</span></span>

- <span data-ttu-id="769a5-129">**Zahlreiche kompakte und unabhängige Codebasen:**</span><span class="sxs-lookup"><span data-stu-id="769a5-129">**Many small independent code bases**.</span></span> <span data-ttu-id="769a5-130">Jedes Team ist für die Erstellung seines eigenen Diensts verantwortlich und verfügt über eine eigene Buildpipeline.</span><span class="sxs-lookup"><span data-stu-id="769a5-130">Each team is responsible for building its own service, with its own build pipeline.</span></span> <span data-ttu-id="769a5-131">In einigen Organisationen verwenden die Teams unter Umständen separate Coderepositorys.</span><span class="sxs-lookup"><span data-stu-id="769a5-131">In some organizations, teams may use separate code repositories.</span></span> <span data-ttu-id="769a5-132">Dies kann dazu führen, dass das Know-how für die Erstellung des Systems auf mehrere Teams verteilt ist und niemand in der Organisation weiß, wie die gesamte Anwendung bereitgestellt wird.</span><span class="sxs-lookup"><span data-stu-id="769a5-132">This could lead to a situation where the knowledge of how to build the system is spread across teams, and nobody in the organization knows how to deploy the entire application.</span></span> <span data-ttu-id="769a5-133">Was passiert beispielsweise in einem Notfallwiederherstellungsszenario, wenn Sie schnell eine Bereitstellung in einem neuen Cluster durchführen müssen?</span><span class="sxs-lookup"><span data-stu-id="769a5-133">For example, what happens in a disaster recovery scenario, if you need to quickly deploy to a new cluster?</span></span>   

- <span data-ttu-id="769a5-134">**Mehrere Sprachen und Frameworks:**</span><span class="sxs-lookup"><span data-stu-id="769a5-134">**Multiple languages and frameworks**.</span></span> <span data-ttu-id="769a5-135">Wenn jedes Team seinen eigenen Technologie-Mix verwendet, kann es schwierig sein, einen einzelnen Buildprozess zu erstellen, der für die gesamte Organisation geeignet ist.</span><span class="sxs-lookup"><span data-stu-id="769a5-135">With each team using its own mix of technologies, it can be difficult to create a single build process that works across the organization.</span></span> <span data-ttu-id="769a5-136">Der Buildprozess muss so flexibel sein, dass jedes Team ihn für die gewählte Sprache oder das gewählte Framework anpassen kann.</span><span class="sxs-lookup"><span data-stu-id="769a5-136">The build process must be flexible enough that every team can adapt it for their choice of language or framework.</span></span> 

- <span data-ttu-id="769a5-137">**Integration und Auslastungstests:**</span><span class="sxs-lookup"><span data-stu-id="769a5-137">**Integration and load testing**.</span></span> <span data-ttu-id="769a5-138">Wenn Teams Updates nach ihrem eigenen Zeitplan veröffentlichen, kann die Entwicklung zuverlässiger End-to-End-Tests zur Herausforderung werden – insbesondere, wenn Dienste von anderen Diensten abhängen.</span><span class="sxs-lookup"><span data-stu-id="769a5-138">With teams releasing updates at their own pace, it can be challenging to design robust end-to-end testing, especially when services have dependencies on other services.</span></span> <span data-ttu-id="769a5-139">Darüber hinaus kann der Betrieb eines vollwertigen Produktionsclusters teuer sein, weshalb es unwahrscheinlich ist, dass jedes Team allein zu Testzwecken einen eigenen vollwertigen Cluster auf Produktionsniveau betreiben kann.</span><span class="sxs-lookup"><span data-stu-id="769a5-139">Moreover, running a full production cluster can be expensive, so it's unlikely that every team will be able to run its own full cluster at production scales, just for testing.</span></span> 

- <span data-ttu-id="769a5-140">**Releaseverwaltung:**</span><span class="sxs-lookup"><span data-stu-id="769a5-140">**Release management**.</span></span> <span data-ttu-id="769a5-141">Jedes Team sollte die Möglichkeit haben, ein Update in der Produktionsumgebung bereitzustellen.</span><span class="sxs-lookup"><span data-stu-id="769a5-141">Every team should have the ability to deploy an update to production.</span></span> <span data-ttu-id="769a5-142">Das bedeutet nicht, dass jedes einzelne Teammitglied über entsprechende Berechtigungen verfügt.</span><span class="sxs-lookup"><span data-stu-id="769a5-142">That doesn't mean that every team member has permissions to do so.</span></span> <span data-ttu-id="769a5-143">Durch eine zentrale Release-Manager-Rolle werden Bereitstellungen jedoch unter Umständen ausgebremst.</span><span class="sxs-lookup"><span data-stu-id="769a5-143">But having a centralized Release Manager role can reduce the velocity of deployments.</span></span> <span data-ttu-id="769a5-144">Je zuverlässiger und stärker automatisiert Ihr CI/CD-Prozess ist, desto weniger Bedarf besteht für eine zentrale Instanz.</span><span class="sxs-lookup"><span data-stu-id="769a5-144">The more that your CI/CD process is automated and reliable, the less there should be a need for a central authority.</span></span> <span data-ttu-id="769a5-145">Für die Veröffentlichung wichtiger Featureupdates und kleinerer Fehlerbehebung können jeweils unterschiedliche Richtlinien gelten.</span><span class="sxs-lookup"><span data-stu-id="769a5-145">That said, you might have different policies for releasing major feature updates versus minor bug fixes.</span></span> <span data-ttu-id="769a5-146">Die Verwendung eines dezentralen Konzepts darf jedoch nicht als Verzicht auf jegliche Art von Governance missverstanden werden.</span><span class="sxs-lookup"><span data-stu-id="769a5-146">Being decentralized does not mean there should be zero governance.</span></span>

- <span data-ttu-id="769a5-147">**Versionsverwaltung für Containerimages:**</span><span class="sxs-lookup"><span data-stu-id="769a5-147">**Container image versioning**.</span></span> <span data-ttu-id="769a5-148">Im Rahmen des Entwicklungs- und Testzyklus erstellt der CI/CD-Prozess zahlreiche Containerimages.</span><span class="sxs-lookup"><span data-stu-id="769a5-148">During the development and test cycle, the CI/CD process will build many container images.</span></span> <span data-ttu-id="769a5-149">Nicht alle dieser Images kommen für die Veröffentlichung in Frage, und nur einige der so genannten Release Candidates werden mithilfe von Push in die Produktionsumgebung übertragen.</span><span class="sxs-lookup"><span data-stu-id="769a5-149">Only some of those are candidates for release, and then only some of those release candidates will get pushed into production.</span></span> <span data-ttu-id="769a5-150">Entwickeln Sie eine klare Versionsverwaltungsstrategie, damit Sie wissen, welche Images derzeit in der Produktionsumgebung bereitgestellt sind, und bei Bedarf einen Rollback auf eine vorherige Version ausführen können.</span><span class="sxs-lookup"><span data-stu-id="769a5-150">You should have a clear versioning strategy, so that you know which images are currently deployed to production, and can roll back to a previous version if necessary.</span></span> 

- <span data-ttu-id="769a5-151">**Dienstupdates:**</span><span class="sxs-lookup"><span data-stu-id="769a5-151">**Service updates**.</span></span> <span data-ttu-id="769a5-152">Wenn Sie einen Dienst auf eine neue Version aktualisieren, dürfen dadurch keine anderen Dienste beeinträchtigt werden, die von diesem Dienst abhängen.</span><span class="sxs-lookup"><span data-stu-id="769a5-152">When you update a service to a new version, it shouldn't break other services that depend on it.</span></span> <span data-ttu-id="769a5-153">Bei einem parallelen Update werden vorübergehend verschiedene Versionen ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="769a5-153">If you do a rolling update, there will be a period of time when a mix of versions is running.</span></span> 
 
<span data-ttu-id="769a5-154">Diese Herausforderungen spiegeln ein grundlegendes Dilemma wider:</span><span class="sxs-lookup"><span data-stu-id="769a5-154">These challenges reflect a fundamental tension.</span></span> <span data-ttu-id="769a5-155">Einerseits müssen Teams so unabhängig wie möglich arbeiten können.</span><span class="sxs-lookup"><span data-stu-id="769a5-155">On the one hand, teams need to work as independently as possible.</span></span> <span data-ttu-id="769a5-156">Andererseits ist eine gewisse Koordinierung erforderlich, damit eine einzelne Person beispielsweise einen Integrationstest durchführen, die gesamte Lösung in einem neuen Cluster erneut bereitstellen oder im Falle eines fehlerhaften Updates einen Rollback ausführen kann.</span><span class="sxs-lookup"><span data-stu-id="769a5-156">On the other hand, some coordination is needed so that a single person can do tasks like running an integration test, redeploying the entire solution to a new cluster, or rolling back a bad update.</span></span> 
 
## <a name="cicd-approaches-for-microservices"></a><span data-ttu-id="769a5-157">CI/CD-Ansätze für Microservices</span><span class="sxs-lookup"><span data-stu-id="769a5-157">CI/CD approaches for microservices</span></span>

<span data-ttu-id="769a5-158">Jedes Dienstteam sollte seine Buildumgebung in einem eigenen Container platzieren.</span><span class="sxs-lookup"><span data-stu-id="769a5-158">It's a good practice for every service team to containerize their build environment.</span></span> <span data-ttu-id="769a5-159">Dieser Container muss über sämtliche Buildtools verfügen, die zum Erstellen der Codeartefakte für den jeweiligen Dienst erforderlich sind.</span><span class="sxs-lookup"><span data-stu-id="769a5-159">This container should have all of the build tools necessary to build the code artifacts for their service.</span></span> <span data-ttu-id="769a5-160">Häufig steht ein offizielles Docker-Image für Ihre Kombination aus Sprache und Framework zur Verfügung.</span><span class="sxs-lookup"><span data-stu-id="769a5-160">Often you can find an official Docker image for your language and framework.</span></span> <span data-ttu-id="769a5-161">Anschließend können Sie den Build mithilfe von `docker run` oder Docker Compose ausführen.</span><span class="sxs-lookup"><span data-stu-id="769a5-161">Then you can use `docker run` or Docker Compose to run the build.</span></span> 

<span data-ttu-id="769a5-162">Mit diesem Ansatz ist die Einrichtung einer neuen Buildumgebung ein Kinderspiel.</span><span class="sxs-lookup"><span data-stu-id="769a5-162">With this approach, it's trivial to set up a new build environment.</span></span> <span data-ttu-id="769a5-163">Ein Entwickler, der Ihren Code erstellen möchte, muss nicht erst eine Reihe von Buildtools installieren, sondern einfach nur das Containerimage ausführen.</span><span class="sxs-lookup"><span data-stu-id="769a5-163">A developer who wants to build your code doesn't need to install a set of build tools, but simply runs the container image.</span></span> <span data-ttu-id="769a5-164">Vielleicht sogar noch wichtiger: Auch Ihr Buildserver kann für diese Aufgabe konfiguriert werden.</span><span class="sxs-lookup"><span data-stu-id="769a5-164">Perhaps more importantly, your build server can be configured to do the same thing.</span></span> <span data-ttu-id="769a5-165">Dadurch müssen Sie die Tools nicht auf dem Buildserver installieren oder sich mit Toolversionskonflikten beschäftigen.</span><span class="sxs-lookup"><span data-stu-id="769a5-165">That way, you don't need to install those tools onto the build server, or manage conflicting versions of tools.</span></span> 

<span data-ttu-id="769a5-166">Führen Sie den Dienst bei lokalen Entwicklungs- und Testaufgaben mithilfe von Docker innerhalb eines Containers aus.</span><span class="sxs-lookup"><span data-stu-id="769a5-166">For local development and testing, use Docker to run the service inside a container.</span></span> <span data-ttu-id="769a5-167">Im Zuge dieses Prozesses müssen Sie unter Umständen weitere Container mit Pseudodiensten oder Testdatenbanken ausführen, die für lokale Tests benötigt werden.</span><span class="sxs-lookup"><span data-stu-id="769a5-167">As part of this process, you may need to run other containers that have mock services or test databases needed for local testing.</span></span> <span data-ttu-id="769a5-168">Sie können diese Container mithilfe von Docker Compose koordinieren oder Kubernetes mithilfe von Minikube lokal ausführen.</span><span class="sxs-lookup"><span data-stu-id="769a5-168">You could use Docker Compose to coordinate these containers, or use Minikube to run Kubernetes locally.</span></span> 

<span data-ttu-id="769a5-169">Wenn der Code bereit ist, öffnen Sie eine Pull-Anforderung, und führen Sie ihn zu einem Master zusammen.</span><span class="sxs-lookup"><span data-stu-id="769a5-169">When the code is ready, open a pull request and merge into master.</span></span> <span data-ttu-id="769a5-170">Dadurch wird auf dem Buildserver ein Auftrag gestartet, der Folgendes umfasst:</span><span class="sxs-lookup"><span data-stu-id="769a5-170">This will start a job on the build server:</span></span>

1. <span data-ttu-id="769a5-171">Erstellen der Codeobjekte</span><span class="sxs-lookup"><span data-stu-id="769a5-171">Build the code assets.</span></span> 
2. <span data-ttu-id="769a5-172">Ausführen von Komponententests für den Code</span><span class="sxs-lookup"><span data-stu-id="769a5-172">Run unit tests against the code.</span></span>
3. <span data-ttu-id="769a5-173">Erstellen des Containerimages</span><span class="sxs-lookup"><span data-stu-id="769a5-173">Build the container image.</span></span>
4. <span data-ttu-id="769a5-174">Testen des Containerimages durch Ausführen von Funktionstests in einem aktiven Container.</span><span class="sxs-lookup"><span data-stu-id="769a5-174">Test the container image by running functional tests on a running container.</span></span> <span data-ttu-id="769a5-175">Dieser Schritt dient zur Erkennung von Fehlern in der Docker-Datei (beispielsweise ein fehlerhafter Einstiegspunkt).</span><span class="sxs-lookup"><span data-stu-id="769a5-175">This step can catch errors in the Docker file, such as a bad entry point.</span></span>
5. <span data-ttu-id="769a5-176">Übertragen des Images an eine Containerregistrierung mithilfe von Push</span><span class="sxs-lookup"><span data-stu-id="769a5-176">Push the image to a container registry.</span></span>
6. <span data-ttu-id="769a5-177">Aktualisieren des Testclusters mit dem neuen Image zur Ausführung von Integrationstests</span><span class="sxs-lookup"><span data-stu-id="769a5-177">Update the test cluster with the new image to run integration tests.</span></span>

<span data-ttu-id="769a5-178">Wenn das Image für die Produktionsumgebung bereit ist, aktualisieren Sie die Bereitstellungsdateien nach Bedarf, um das neueste Image anzugeben (einschließlich möglicher Kubernetes-Konfigurationsdateien).</span><span class="sxs-lookup"><span data-stu-id="769a5-178">When the image is ready to go into production, update the deployment files as needed to specify the latest image, including any Kubernetes configuration files.</span></span> <span data-ttu-id="769a5-179">Wenden Sie dann das Update auf den Produktionscluster an.</span><span class="sxs-lookup"><span data-stu-id="769a5-179">Then apply the update to the production cluster.</span></span>

<span data-ttu-id="769a5-180">Im Anschluss folgen einige Empfehlungen zur Verbesserung der Zuverlässigkeit von Bereitstellungen:</span><span class="sxs-lookup"><span data-stu-id="769a5-180">Here are some recommendations for making deployments more reliable:</span></span>
 
- <span data-ttu-id="769a5-181">Definieren Sie organisationsweite Konventionen für Containertags und für die Versionsverwaltung sowie Namenskonventionen für im Cluster bereitgestellte Ressourcen (Pods, Dienste und Ähnliches).</span><span class="sxs-lookup"><span data-stu-id="769a5-181">Define organization-wide conventions for container tags, versioning, and naming conventions for resources deployed to the cluster (pods, services, and so on).</span></span> <span data-ttu-id="769a5-182">Dies kann die Diagnose von Bereitstellungsproblemen vereinfachen.</span><span class="sxs-lookup"><span data-stu-id="769a5-182">That can make it easier to diagnose deployment issues.</span></span> 

- <span data-ttu-id="769a5-183">Erstellen Sie zwei separate Containerregistrierungen: eine für Entwicklungs-/Testaufgaben und eine für die Produktion.</span><span class="sxs-lookup"><span data-stu-id="769a5-183">Create two separate container registries, one for development/testing and one for production.</span></span> <span data-ttu-id="769a5-184">Übertragen Sie ein Image erst dann mithilfe von Push in die Produktionsregistrierung, wenn Sie bereit sind, es in der Produktionsumgebung bereitzustellen.</span><span class="sxs-lookup"><span data-stu-id="769a5-184">Don't push an image to the production registry until you're ready to deploy it into production.</span></span> <span data-ttu-id="769a5-185">Wenn Sie diese Vorgehensweise mit der semantischen Versionsverwaltung von Containerimages kombinieren, verringert sich die Wahrscheinlichkeit, dass Sie versehentlich eine Version bereitstellen, die nicht für die Veröffentlichung freigegeben wurde.</span><span class="sxs-lookup"><span data-stu-id="769a5-185">If you combine this practice with semantic versioning of container images, it can reduce the chance of accidentally deploying a version that wasn't approved for release.</span></span>

## <a name="updating-services"></a><span data-ttu-id="769a5-186">Aktualisieren von Diensten</span><span class="sxs-lookup"><span data-stu-id="769a5-186">Updating services</span></span>

<span data-ttu-id="769a5-187">Für die Aktualisierung eines Diensts, der sich bereits in Produktion befindet, gibt es verschiedene Strategien.</span><span class="sxs-lookup"><span data-stu-id="769a5-187">There are various strategies for updating a service that's already in production.</span></span> <span data-ttu-id="769a5-188">Hier werden drei gängige Optionen erläutert: paralleles Update, Blaugrün-Bereitstellung und Canary-Release.</span><span class="sxs-lookup"><span data-stu-id="769a5-188">Here we discuss three common options: Rolling update, blue-green deployment, and canary release.</span></span>

### <a name="rolling-update"></a><span data-ttu-id="769a5-189">Paralleles Update</span><span class="sxs-lookup"><span data-stu-id="769a5-189">Rolling update</span></span> 

<span data-ttu-id="769a5-190">Bei einem parallelen Update stellen Sie neue Instanzen eines Diensts bereit, und diese neuen Instanzen nehmen sofort Anforderungen entgegen.</span><span class="sxs-lookup"><span data-stu-id="769a5-190">In a rolling update, you deploy new instances of a service, and the new instances start receiving requests right away.</span></span> <span data-ttu-id="769a5-191">Wenn die neuen Instanzen online geschaltet werden, werden die vorherigen Instanzen entfernt.</span><span class="sxs-lookup"><span data-stu-id="769a5-191">As the new instances come up, the previous instances are removed.</span></span>

<span data-ttu-id="769a5-192">Parallele Updates sind das Standardverhalten in Kubernetes, wenn Sie die Pod-Spezifikation für eine Bereitstellung aktualisieren.</span><span class="sxs-lookup"><span data-stu-id="769a5-192">Rolling updates are the default behavior in Kubernetes when you update the pod spec for a Deployment.</span></span> <span data-ttu-id="769a5-193">Der Bereitstellungscontroller erstellt eine neue Replikatgruppe (ReplicaSet) für die aktualisierten Pods.</span><span class="sxs-lookup"><span data-stu-id="769a5-193">The Deployment controller creates a new ReplicaSet for the updated pods.</span></span> <span data-ttu-id="769a5-194">Anschließend wird die neue Replikatgruppe zentral hoch- und die alte Gruppe zentral herunterskaliert, sodass die gewünschte Replikatanzahl erhalten bleibt.</span><span class="sxs-lookup"><span data-stu-id="769a5-194">Then it scales up the new ReplicaSet while scaling down the old one, to maintain the desired replica count.</span></span> <span data-ttu-id="769a5-195">Alte Pods werden erst gelöscht, wenn die neuen Pods bereit sind.</span><span class="sxs-lookup"><span data-stu-id="769a5-195">It doesn't delete old pods until the new ones are ready.</span></span> <span data-ttu-id="769a5-196">Kubernetes protokolliert den Verlauf des Updates, damit Sie bei Bedarf mithilfe von kubectl einen Rollback für das Update ausführen können.</span><span class="sxs-lookup"><span data-stu-id="769a5-196">Kubernetes keeps a history of the update, so you can use kubectl to roll back an update if needed.</span></span> 

<span data-ttu-id="769a5-197">Falls Ihr Dienst eine langwierige Startaufgabe ausführt, können Sie einen Bereitschaftstest definieren.</span><span class="sxs-lookup"><span data-stu-id="769a5-197">If your service performs a long startup task, you can define a readiness probe.</span></span> <span data-ttu-id="769a5-198">Der Bereitschaftstest meldet, wenn der Container für den Empfang von Datenverkehr bereit ist.</span><span class="sxs-lookup"><span data-stu-id="769a5-198">The readiness probe reports when the container is ready to start receiving traffic.</span></span> <span data-ttu-id="769a5-199">Kubernetes sendet erst dann Datenverkehr an den Pod, wenn der Test eine Erfolgsmeldung zurückgibt.</span><span class="sxs-lookup"><span data-stu-id="769a5-199">Kubernetes won't send traffic to the pod until the probe reports success.</span></span> 

<span data-ttu-id="769a5-200">Eine der Herausforderungen bei parallelen Updates besteht darin, dass während der Aktualisierung eine Mischung aus alten und neuen Versionen ausgeführt wird und Datenverkehr empfängt.</span><span class="sxs-lookup"><span data-stu-id="769a5-200">One challenge of rolling updates is that during the update process, a mix of old and new versions are running and receiving traffic.</span></span> <span data-ttu-id="769a5-201">Während dieser Zeit können Anforderungen jeweils an eine der beiden Versionen weitergeleitet werden.</span><span class="sxs-lookup"><span data-stu-id="769a5-201">During this period, any request could get routed to either of the two versions.</span></span> <span data-ttu-id="769a5-202">Dies kann abhängig vom Umfang der Änderungen zwischen den beiden Versionen zu Problemen führen.</span><span class="sxs-lookup"><span data-stu-id="769a5-202">That may or may not cause problems, depending on the scope of the changes between the two versions.</span></span> 

### <a name="blue-green-deployment"></a><span data-ttu-id="769a5-203">Blaugrün-Bereitstellung</span><span class="sxs-lookup"><span data-stu-id="769a5-203">Blue-green deployment</span></span>

<span data-ttu-id="769a5-204">Bei einer Blaugrün-Bereitstellung stellen Sie die neue Version zusammen mit der vorherigen Version bereit.</span><span class="sxs-lookup"><span data-stu-id="769a5-204">In a blue-green deployment, you deploy the new version alongside the previous version.</span></span> <span data-ttu-id="769a5-205">Nach der Überprüfung der neuen Version leiten Sie sämtlichen Datenverkehr von der vorherigen Version zur neuen Version um.</span><span class="sxs-lookup"><span data-stu-id="769a5-205">After you validate the new version, you switch all traffic at once from the previous version to the new version.</span></span> <span data-ttu-id="769a5-206">Anschließend überwachen Sie die Anwendung auf mögliche Probleme.</span><span class="sxs-lookup"><span data-stu-id="769a5-206">After the switch, you monitor the application for any problems.</span></span> <span data-ttu-id="769a5-207">Im Problemfall können Sie zur alten Version zurückkehren.</span><span class="sxs-lookup"><span data-stu-id="769a5-207">If something goes wrong, you can swap back to the old version.</span></span> <span data-ttu-id="769a5-208">Liegen keine Probleme, können Sie die alte Version löschen.</span><span class="sxs-lookup"><span data-stu-id="769a5-208">Assuming there are no problems, you can delete the old version.</span></span>

<span data-ttu-id="769a5-209">Bei einer eher traditionellen monolithischen oder n-schichtigen Anwendung war eine Blaugrün-Bereitstellung in der Regel mit der Bereitstellung zweier identischer Umgebungen verbunden.</span><span class="sxs-lookup"><span data-stu-id="769a5-209">With a more traditional monolithic or N-tier application, blue-green deployment generally meant provisioning two identical environments.</span></span> <span data-ttu-id="769a5-210">Dabei musste die neue Version in einer Stagingumgebung bereitgestellt und der Clientdatenverkehr anschließend an die Stagingumgebung umgeleitet werden (beispielsweise durch Austauschen der VIP-Adressen).</span><span class="sxs-lookup"><span data-stu-id="769a5-210">You would deploy the new version to a staging environment, then redirect client traffic to the staging environment &mdash; for example, by swapping VIP addresses.</span></span>

<span data-ttu-id="769a5-211">In Kubernetes müssen Sie für eine Blaugrün-Bereitstellung keinen separaten Cluster bereitstellen.</span><span class="sxs-lookup"><span data-stu-id="769a5-211">In Kubernetes, you don't need to provision a separate cluster to do blue-green deployments.</span></span> <span data-ttu-id="769a5-212">Stattdessen können Sie Selektoren nutzen.</span><span class="sxs-lookup"><span data-stu-id="769a5-212">Instead, you can take advantage of selectors.</span></span> <span data-ttu-id="769a5-213">Erstellen Sie eine neue Bereitstellungsressource mit einer neuen Pod-Spezifikation und einem anderen Satz von Bezeichnungen.</span><span class="sxs-lookup"><span data-stu-id="769a5-213">Create a new Deployment resource with a new pod spec and a different set of labels.</span></span> <span data-ttu-id="769a5-214">Erstellen Sie diese Bereitstellung, ohne die vorherige Bereitstellung zu löschen oder den Dienst zu ändern, der darauf verweist.</span><span class="sxs-lookup"><span data-stu-id="769a5-214">Create this deployment, without deleting the previous deployment or modifying the service that points to it.</span></span> <span data-ttu-id="769a5-215">Wenn die neuen Pods aktiv sind, können Sie den Selektor des Diensts auf die neue Bereitstellung aktualisieren.</span><span class="sxs-lookup"><span data-stu-id="769a5-215">Once the new pods are running, you can update the service's selector to match the new deployment.</span></span> 

<span data-ttu-id="769a5-216">Ein Vorteil von Blaugrün Bereitstellungen ist, dass alle Pods gleichzeitig gewechselt werden.</span><span class="sxs-lookup"><span data-stu-id="769a5-216">An advantage of blue-green deployments is that the service switches all the pods at the same time.</span></span> <span data-ttu-id="769a5-217">Nach der Aktualisierung des Diensts werden alle neuen Anforderungen an die neue Version weitergeleitet.</span><span class="sxs-lookup"><span data-stu-id="769a5-217">After the service is updated, all new requests get routed to the new version.</span></span> <span data-ttu-id="769a5-218">Ein Nachteil ist, dass während der Aktualisierung doppelt so viele Pods für den Dienst (aktuelle und neue Version) aktiv sind.</span><span class="sxs-lookup"><span data-stu-id="769a5-218">One drawback is that during the update, you are running twice as many pods for the service (current and next).</span></span> <span data-ttu-id="769a5-219">Wenn die Pods einen hohen Bedarf an CPU- oder Arbeitsspeicherressourcen haben, müssen Sie den Cluster zur Bewältigung des Ressourcenbedarfs möglicherweise vorübergehend horizontal hochskalieren.</span><span class="sxs-lookup"><span data-stu-id="769a5-219">If the pods require a lot of CPU or memory resources, you may need to scale out the cluster temporarily to handle the resource consumption.</span></span> 

### <a name="canary-release"></a><span data-ttu-id="769a5-220">Canary-Release</span><span class="sxs-lookup"><span data-stu-id="769a5-220">Canary release</span></span>

<span data-ttu-id="769a5-221">Bei einem Canary-Release führen Sie eine aktualisierte Version für eine geringe Anzahl von Clients ein.</span><span class="sxs-lookup"><span data-stu-id="769a5-221">In a canary release, you roll out an updated version to a small number of clients.</span></span> <span data-ttu-id="769a5-222">Anschließend überwachen Sie das Verhalten des neuen Diensts, bevor Sie ihn für alle Clients einführen.</span><span class="sxs-lookup"><span data-stu-id="769a5-222">Then you monitor the behavior of the new service before rolling it out to all clients.</span></span> <span data-ttu-id="769a5-223">Dies ermöglicht eine langsame, kontrollierte Einführung, die Beobachtung echter Daten und die Erkennung von Problemen, bevor alle Kunden betroffen sind.</span><span class="sxs-lookup"><span data-stu-id="769a5-223">This lets you do a slow rollout in a controlled fashion, observe real data, and spot problems before all customers are affected.</span></span>

<span data-ttu-id="769a5-224">Die Verwaltung eines Canary-Release ist im Vergleich zu einer Blaugrün-Bereitstellung oder einem parallelen Update komplexer, da Anforderungen dynamisch an verschiedene Versionen des Diensts weitergeleitet werden müssen.</span><span class="sxs-lookup"><span data-stu-id="769a5-224">A canary release is more complex to manage than either blue-green or rolling update, because you must dynamically route requests to different versions of the service.</span></span> <span data-ttu-id="769a5-225">In Kubernetes können Sie einen Dienst so konfigurieren, dass er sich über zwei Replikatgruppen (einen für jede Version) erstreckt, und die Replikatanzahl manuell anpassen.</span><span class="sxs-lookup"><span data-stu-id="769a5-225">In Kubernetes, you can configure a Service to span two replica sets (one for each version) and adjust the replica counts manually.</span></span> <span data-ttu-id="769a5-226">Aufgrund des von Kubernetes verwendeten Lastenausgleichs zwischen Pods ist dieser Ansatz jedoch nicht sehr präzise.</span><span class="sxs-lookup"><span data-stu-id="769a5-226">However, this approach is rather coarse-grained, because of the way Kubernetes load balances across pods.</span></span> <span data-ttu-id="769a5-227">Ein Beispiel: Wenn Sie insgesamt über zehn Replikate verfügen, können Sie Datenverkehr nur in Zehn-Prozent-Schritten verlagern.</span><span class="sxs-lookup"><span data-stu-id="769a5-227">For example, if you have a total of ten replicas, you can only shift traffic in 10% increments.</span></span> <span data-ttu-id="769a5-228">Bei Verwendung eines Dienstnetzes können Sie mithilfe der entsprechenden Routingregeln eine komplexere Canary-Release-Strategie implementieren.</span><span class="sxs-lookup"><span data-stu-id="769a5-228">If you are using a service mesh, you can use the service mesh routing rules to implement a more sophisticated canary release strategy.</span></span> <span data-ttu-id="769a5-229">Im Anschluss finden Sie einige hilfreiche Ressourcen:</span><span class="sxs-lookup"><span data-stu-id="769a5-229">Here are some resources that may be helpful:</span></span>

- <span data-ttu-id="769a5-230">Kubernetes ohne Dienstnetz: [Canary-Bereitstellungen](https://kubernetes.io/docs/concepts/cluster-administration/manage-deployment/#canary-deployments)</span><span class="sxs-lookup"><span data-stu-id="769a5-230">Kubernetes without service mesh: [Canary deployments](https://kubernetes.io/docs/concepts/cluster-administration/manage-deployment/#canary-deployments)</span></span>
- <span data-ttu-id="769a5-231">Linkerd: [Dynamic request routing](https://linkerd.io/features/routing/) (Dynamisches Anforderungsrouting)</span><span class="sxs-lookup"><span data-stu-id="769a5-231">Linkerd: [Dynamic request routing](https://linkerd.io/features/routing/)</span></span>
- <span data-ttu-id="769a5-232">Istio: [Canary Deployments using Istio](https://istio.io/blog/canary-deployments-using-istio.html) (Canary-Bereitstellungen mit Istio)</span><span class="sxs-lookup"><span data-stu-id="769a5-232">Istio: [Canary Deployments using Istio](https://istio.io/blog/canary-deployments-using-istio.html)</span></span>

## <a name="conclusion"></a><span data-ttu-id="769a5-233">Zusammenfassung</span><span class="sxs-lookup"><span data-stu-id="769a5-233">Conclusion</span></span>

<span data-ttu-id="769a5-234">In den letzten Jahren hat in der Branche ein grundlegender Wandel stattgefunden – weg vom *System of Record* hin zum *System of Engagement*.</span><span class="sxs-lookup"><span data-stu-id="769a5-234">In recent years, there has been a sea change in the industry, a movement from building *systems of record* to building *systems of engagement*.</span></span>

<span data-ttu-id="769a5-235">Bei einem System of Record handelt es sich um herkömmliche Backoffice-Datenverwaltungsanwendungen.</span><span class="sxs-lookup"><span data-stu-id="769a5-235">Systems of record are traditional back-office data management applications.</span></span> <span data-ttu-id="769a5-236">Den Kern dieser Systeme bildet meist ein RDBMS, das die alleingültige Quelle darstellt.</span><span class="sxs-lookup"><span data-stu-id="769a5-236">At the heart of these systems there often sits an RDBMS that is the single source of truth.</span></span> <span data-ttu-id="769a5-237">Der Begriff „System of Engagement“ wird Geoffrey Moore zugeschrieben, der ihn 2011 in seiner Arbeit *Systems of Engagement and the Future of Enterprise IT* verwendet hat.</span><span class="sxs-lookup"><span data-stu-id="769a5-237">The term "system of engagement" is credited to Geoffrey Moore, in his 2011 paper *Systems of Engagement and the Future of Enterprise IT*.</span></span> <span data-ttu-id="769a5-238">Bei einem System of Engagement handelt es sich um Anwendungen, deren Schwerpunkt auf Kommunikation und Zusammenarbeit liegt.</span><span class="sxs-lookup"><span data-stu-id="769a5-238">Systems of engagement are applications focused on communication and collaboration.</span></span> <span data-ttu-id="769a5-239">Sie verbinden Benutzer in Echtzeit.</span><span class="sxs-lookup"><span data-stu-id="769a5-239">They connect people in real time.</span></span> <span data-ttu-id="769a5-240">Sie müssen rund um die Uhr verfügbar sein.</span><span class="sxs-lookup"><span data-stu-id="769a5-240">They must be available 24/7.</span></span> <span data-ttu-id="769a5-241">Neue Features werden regelmäßig eingeführt, ohne die Anwendung offline zu schalten.</span><span class="sxs-lookup"><span data-stu-id="769a5-241">New features are introduced regularly without taking the application offline.</span></span> <span data-ttu-id="769a5-242">Benutzer haben höhere Ansprüche und weniger Verständnis für unerwartete Verzögerungen oder Ausfälle.</span><span class="sxs-lookup"><span data-stu-id="769a5-242">Users expect more and are less patient of unexpected delays or downtime.</span></span>

<span data-ttu-id="769a5-243">Im Verbraucherbereich kann eine höhere Benutzerfreundlichkeit einen messbaren geschäftlichen Nutzen haben.</span><span class="sxs-lookup"><span data-stu-id="769a5-243">In the consumer space, a better user experience can have measurable business value.</span></span> <span data-ttu-id="769a5-244">Die Zeit, die ein Benutzer mit einer Anwendung verbringt, führt ggf. direkt zu Umsätzen.</span><span class="sxs-lookup"><span data-stu-id="769a5-244">The amount of time that a user engages with an application may translate directly into revenue.</span></span> <span data-ttu-id="769a5-245">Und im Bereich geschäftlicher Systeme haben sich die Erwartungen der Benutzer verändert.</span><span class="sxs-lookup"><span data-stu-id="769a5-245">And in the realm of business systems, users' expectations have changed.</span></span> <span data-ttu-id="769a5-246">Wenn diese Systeme die Kommunikation und Zusammenarbeit fördern sollen, müssen sie sich ein Beispiel an kundenorientierten Anwendungen nehmen.</span><span class="sxs-lookup"><span data-stu-id="769a5-246">If these systems aim to foster communication and collaboration, they must take their cue from consumer-facing applications.</span></span>

<span data-ttu-id="769a5-247">Microservices sind eine Reaktion auf diese Veränderungen.</span><span class="sxs-lookup"><span data-stu-id="769a5-247">Microservices are a response to this changing landscape.</span></span> <span data-ttu-id="769a5-248">Durch die Aufspaltung einer monolithischen Anwendung in eine Reihe lose gekoppelter Dienste können wir den Releasezyklus der einzelnen Dienste steuern und häufige Updates ohne Ausfallzeiten oder beeinträchtigende Änderungen ermöglichen.</span><span class="sxs-lookup"><span data-stu-id="769a5-248">By decomposing a monolithic application into a group of loosely coupled services, we can control the release cycle of each service, and enable frequent updates without downtime or breaking changes.</span></span> <span data-ttu-id="769a5-249">Microservices tragen auch zur besseren Skalierbarkeit, Fehlerisolation und Resilienz bei.</span><span class="sxs-lookup"><span data-stu-id="769a5-249">Microservices also help with scalability, failure isolation, and resiliency.</span></span> <span data-ttu-id="769a5-250">Inzwischen vereinfachen Cloudplattformen die Erstellung und Ausführung von Microservices mit automatisierter Bereitstellung von Computeressourcen, Containerorchestratoren als Dienst und ereignisgesteuerten serverlosen Umgebungen.</span><span class="sxs-lookup"><span data-stu-id="769a5-250">Meanwhile, cloud platforms are making it easier to build and run microservices, with automated provisioning of compute resources, container orchestrators as a service, and event-driven serverless environments.</span></span>

<span data-ttu-id="769a5-251">Andererseits sind Microservices-Architekturen auch mit zahlreichen Herausforderungen verbunden.</span><span class="sxs-lookup"><span data-stu-id="769a5-251">But as we've seen, microservices architectures also being a lot of challenges.</span></span> <span data-ttu-id="769a5-252">Entscheidend ist ein solides Design.</span><span class="sxs-lookup"><span data-stu-id="769a5-252">To succeed, you must start from a solid design.</span></span> <span data-ttu-id="769a5-253">Gehen Sie bei der Analyse der Domäne, bei der Wahl der Technologien, bei der Modellierung der Daten, bei der Gestaltung der APIs sowie beim Aufbau einer ausgereiften DevOps-Kultur mit der nötigen Sorgfalt vor.</span><span class="sxs-lookup"><span data-stu-id="769a5-253">You must put careful thought into analyzing the domain, choosing technologies, modeling data, designing APIs, and building a mature DevOps culture.</span></span> <span data-ttu-id="769a5-254">Wir hoffen, wir konnten Ihnen mit diesem Leitfaden und der dazugehörigen [Referenzimplementierung](https://github.com/mspnp/microservices-reference-implementation) weiterhelfen.</span><span class="sxs-lookup"><span data-stu-id="769a5-254">We hope that this guide, and the accompanying [reference implementation](https://github.com/mspnp/microservices-reference-implementation), has helped to illuminate the journey.</span></span> 

